<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DATA EDITORIAL / ANALYTICS v4.0</title>

  <!-- ================================================================
       FONTS
       ================================================================ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&family=Noto+Sans+JP:wght@300;400;500;700;900&display=swap" rel="stylesheet">

  <!-- ================================================================
       EXTERNAL LIBRARIES
       ================================================================ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <!-- ================================================================
       CSS
       ================================================================ -->
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <!-- ================================================================
       HTML STRUCTURE
       ================================================================ -->

  <div class="container">
    <!-- ==================== HEADER ==================== -->
    <header>
      <div class="header-top">
        <div class="brand-block">
          <h1>DATA EDITORIAL</h1>
          <p class="tagline">Universal Retail Analytics Platform</p>
        </div>
        <div class="version-badge">VERSION 4.0</div>
      </div>

      <!-- CSV UPLOAD -->
      <div class="upload-zone" id="uploadZone">
        <h3>DROP CSV HERE</h3>
        <p>任意のPOSデータをドラッグ＆ドロップ、またはクリックして選択</p>
        <input type="file" id="csvInput" accept=".csv">
      </div>
    </header>

    <!-- ==================== NAVIGATION ==================== -->
    <nav class="nav-tabs">
      <button class="nav-btn active" data-tab="flow">FLOW<span>買物動線</span></button>
      <button class="nav-btn" data-tab="trend">TREND<span>時系列分析</span></button>
      <button class="nav-btn" data-tab="structure">STRUCTURE<span>商品構造</span></button>
      <button class="nav-btn" data-tab="customer">CUSTOMER<span>顧客DNA</span></button>
    </nav>

    <!-- ==================== KPI SUMMARY ==================== -->
    <section class="kpi-grid">
      <div class="kpi-block emerald">
        <div class="kpi-label">Total Revenue</div>
        <div class="kpi-value" id="kpiRevenue">¥0</div>
        <div class="kpi-sub">月間売上高</div>
      </div>
      <div class="kpi-block cyan">
        <div class="kpi-label">Transactions</div>
        <div class="kpi-value" id="kpiTx">0</div>
        <div class="kpi-sub">総客数</div>
      </div>
      <div class="kpi-block gold">
        <div class="kpi-label">Avg Basket</div>
        <div class="kpi-value" id="kpiBasket">¥0</div>
        <div class="kpi-sub">客単価</div>
      </div>
      <div class="kpi-block rose">
        <div class="kpi-label">Visit Freq</div>
        <div class="kpi-value" id="kpiFreq">0.0</div>
        <div class="kpi-sub">来店頻度/月</div>
      </div>
    </section>

    <!-- ==================== TAB 1: FLOW SIMULATION ==================== -->
    <div class="tab-content active" id="tab-flow">
      <div class="sim-panel">
        <div class="sim-header">
          <div>
            <div class="sim-title">Abstract Retail Graph</div>
            <div style="font-size:11px;color:var(--gray-500);margin-top:4px;">ノード連結型の買物行動シミュレーション — 確率遷移モデル</div>
          </div>
          <div class="sim-controls">
            <div class="sim-stats">
              Active: <span id="simActive">0</span> &nbsp;|&nbsp; Complete: <span id="simComplete">0</span> &nbsp;|&nbsp; Avg: <span id="simAvgTime">0.0</span>s
            </div>
            <button class="sim-btn" id="simToggle">START</button>
          </div>
        </div>
        <canvas id="simCanvas"></canvas>
        <div class="sim-legend">
          <div class="legend-item"><div class="legend-dot" style="background:var(--emerald)"></div>ENTRANCE / PRODUCE</div>
          <div class="legend-item"><div class="legend-dot" style="background:var(--rose)"></div>MEAT / FISH</div>
          <div class="legend-item"><div class="legend-dot" style="background:var(--gold)"></div>DELI / BAKERY</div>
          <div class="legend-item"><div class="legend-dot" style="background:var(--cyan)"></div>CENTER / BEVERAGE</div>
          <div class="legend-item"><div class="legend-dot" style="background:var(--white)"></div>CHECKOUT</div>
        </div>
      </div>
    </div>

    <!-- ==================== TAB 2: TREND ==================== -->
    <div class="tab-content" id="tab-trend">
      <div class="grid-2">
        <div class="card">
          <div class="card-header">
            <div>
              <h2 class="section-title-en">Daily Trend</h2>
              <p class="section-title-jp">日別売上推移 — 10月度</p>
            </div>
            <div class="card-badge">LINE</div>
          </div>
          <div class="chart-container chart-container-lg">
            <canvas id="chartDaily"></canvas>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div>
              <h2 class="section-title-en">Hourly Pattern</h2>
              <p class="section-title-jp">時間帯別来店パターン</p>
            </div>
            <div class="card-badge">BAR</div>
          </div>
          <div class="chart-container chart-container-lg">
            <canvas id="chartHourly"></canvas>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:24px;">
        <div class="card-header">
          <div>
            <h2 class="section-title-en">Day × Hour Heatmap</h2>
            <p class="section-title-jp">曜日×時間帯の売上強度マトリクス（月曜始まり・0円データ除外）</p>
          </div>
          <div class="card-badge">MATRIX</div>
        </div>
        <div id="heatmapContainer" style="overflow-x:auto;margin-top:16px;"></div>
      </div>
    </div>

    <!-- ==================== TAB 3: STRUCTURE ==================== -->
    <div class="tab-content" id="tab-structure">
      <div class="grid-2">
        <div class="card">
          <div class="card-header">
            <div>
              <h2 class="section-title-en">Category Share</h2>
              <p class="section-title-jp">カテゴリ別売上構成比</p>
            </div>
            <div class="card-badge">DOUGHNUT</div>
          </div>
          <div class="chart-container chart-container-lg">
            <canvas id="chartCategory"></canvas>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div>
              <h2 class="section-title-en">Basket Affinity</h2>
              <p class="section-title-jp">併売相関ネットワーク — カテゴリ間の購買連動性</p>
            </div>
            <div class="card-badge">D3 NETWORK</div>
          </div>
          <svg id="networkSvg"></svg>
        </div>
      </div>

      <div class="card" style="margin-top:24px;">
        <div class="card-header">
          <div>
            <h2 class="section-title-en">Category Breakdown</h2>
            <p class="section-title-jp">全カテゴリ詳細（青果・製菓・日配等を含む）</p>
          </div>
        </div>
        <div class="chart-container chart-container-xl">
          <canvas id="chartCategoryBar"></canvas>
        </div>
      </div>
    </div>

    <!-- ==================== TAB 4: CUSTOMER ==================== -->
    <div class="tab-content" id="tab-customer">
      <div class="grid-3">
        <!-- GENDER -->
        <div class="card">
          <div class="card-header">
            <div>
              <h2 class="section-title-en">Gender</h2>
              <p class="section-title-jp">性別構成（男→女）</p>
            </div>
          </div>
          <div id="genderBars"></div>
        </div>

        <!-- AGE -->
        <div class="card">
          <div class="card-header">
            <div>
              <h2 class="section-title-en">Age Segment</h2>
              <p class="section-title-jp">年代別（10代→80代以上）</p>
            </div>
          </div>
          <div id="ageBars"></div>
        </div>

        <!-- LIFESTAGE -->
        <div class="card">
          <div class="card-header">
            <div>
              <h2 class="section-title-en">Lifestage</h2>
              <p class="section-title-jp">ライフステージ別</p>
            </div>
          </div>
          <div id="lifeBars"></div>
        </div>
      </div>

      <!-- RFM MATRIX -->
      <div class="card" style="margin-top:24px;">
        <div class="card-header">
          <div>
            <h2 class="section-title-en">RFM Segmentation</h2>
            <p class="section-title-jp">顧客ロイヤリティマトリクス — Recency × Frequency × Monetary</p>
          </div>
          <div class="card-badge">INSIGHT</div>
        </div>
        <div id="rfmMatrix"></div>
      </div>

      <!-- PERSONA RADAR -->
      <div class="card" style="margin-top:24px;">
        <div class="card-header">
          <div>
            <h2 class="section-title-en">Persona Radar</h2>
            <p class="section-title-jp">代表的顧客ペルソナの行動特性</p>
          </div>
        </div>
        <div class="persona-grid" id="personaGrid"></div>
      </div>

      <!-- N1 NARRATIVE -->
      <div class="n1-profile" id="n1Profile">
        <div class="n1-header">
          <div class="n1-avatar">N1</div>
          <div class="n1-meta">
            <h3 id="n1Name">読み込み中...</h3>
            <div class="n1-tags" id="n1Tags"></div>
          </div>
        </div>
        <p class="n1-narrative" id="n1Narrative">データを読み込むと、最も特徴的な顧客像を日本語で要約します。</p>
        <div class="n1-stats" id="n1Stats"></div>
      </div>
    </div>

    <!-- ==================== FOOTER ==================== -->
    <footer>
      <p class="footer-text">DATA EDITORIAL / UNIVERSAL RETAIL ANALYTICS — VERSION 4.0</p>
    </footer>
  </div>

  <!-- ================================================================
       JAVASCRIPT MODULES
       ================================================================ -->
  <script src="js/config.js"></script>
  <script src="js/data.js"></script>
  <script src="js/charts.js"></script>
  <script src="js/simulation.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
